# Database Migrations

This directory contains database migration scripts for the codegen-on-oss project.

## Overview

We use Alembic for database migrations. Alembic is a lightweight database migration tool for SQLAlchemy.

## Directory Structure

- `env.py`: Alembic environment configuration
- `script.py.mako`: Template for migration scripts
- `alembic.ini`: Alembic configuration file
- `versions/`: Directory containing migration scripts

## Usage

### Creating a Migration

To create a new migration:

```bash
# Generate a migration script
alembic revision --autogenerate -m "description of changes"
```

This will create a new migration script in the `versions/` directory.

### Running Migrations

To apply migrations:

```bash
# Apply all pending migrations
alembic upgrade head

# Apply specific migration
alembic upgrade <revision>

# Rollback to a previous migration
alembic downgrade <revision>

# Rollback one migration
alembic downgrade -1
```

### Checking Migration Status

To check the current migration status:

```bash
# Show current revision
alembic current

# Show migration history
alembic history --verbose
```

## Best Practices

1. **Always review autogenerated migrations**: Alembic's autogenerate feature is not perfect. Always review the generated migration scripts before applying them.

2. **Test migrations**: Test migrations on a development database before applying them to production.

3. **Include both upgrade and downgrade paths**: Make sure both upgrade and downgrade functions are properly implemented.

4. **Keep migrations small and focused**: Each migration should make a small, focused change to the database schema.

5. **Use meaningful migration names**: The migration name should clearly describe the changes being made.

6. **Commit migrations to version control**: Migration scripts should be committed to version control along with the code changes that require them.

